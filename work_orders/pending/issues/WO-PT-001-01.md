# Issue Draft: [WORK ORDER] WO-PT-001-01 â€“ Implement evv.patient Model

**Work Order ID:** WO-PT-001-01  
**Priority:** priority:high  
**Module:** module:evv-compliance

## 1. Context & Objective

Create the `evv.patient` model with unique external ID enforcement, partner search disambiguation, views, security, and documentation per `PT-001`.

## 2. Repository Setup

**Repository:** evv  
**Base Branch:** `main`  
**New Branch:** `feature/WO-PT-001-01-patient-model`

**Setup Commands:**
```bash
cd /home/james/development/aos-development/evv
git checkout main
git pull origin main
git checkout -b feature/WO-PT-001-01-patient-model
```

## 3. Problem Statement & Technical Details

### Model
- `evv/addons/evv_patients/models/evv_patient.py`
  - Fields: `partner_id` (Many2one `res.partner`, required), `recipient_id_external` (Char, unique when set), `case_manager_id` (Many2one `evv.case_manager`), `name` (related `partner_id.name`, stored, readonly).
  - `_sql_constraints` for unique `recipient_id_external`.

### Partner Search Disambiguation
- Extend partner `name_get` (or provide context-specific helper) to display non-sensitive info (email/city) so users can distinguish duplicates when selecting `partner_id`.

### Views
- `evv/addons/evv_patients/views/evv_patient_views.xml`
  - Tree/form views matching mockup (partner, external ID, case manager). Provide search view with additional info.

### Security
- `evv/addons/evv_patients/security/ir.model.access.csv`
  - DC: create/read/write
  - Admin: full
  - Others: deny (add Clinical Supervisor read-only if required; document assumption).
- Record rules if necessary to restrict read access to permitted roles.

### Tests
- `evv/addons/evv_patients/tests/test_patient_record.py`
  - SavepointCase covering creation, duplicate external ID prevention, case manager linkage, partner search disambiguation, access control.

### Documentation
- `evv/addons/evv_patients/docs/models/evv_patient.md`
  - Describe fields, constraints, search behavior, security.

### Manifest
- Update `__manifest__.py` with dependencies (`evv_core`, `evv_case_managers`) and new data entries.

## 4. Required Implementation

- Implement model with constraints and Story references.
- Add partner search enhancement using non-sensitive metadata.
- Configure views and menus as needed.
- Set up ACLs/record rules per compliance.
- Write SavepointCase tests verifying requirements.
- Update documentation accordingly.

## 5. Acceptance Criteria

- [ ] All requirements implemented.  
- [ ] Code follows `01-odoo-coding-standards.md`.  
- [ ] Code is tenancy-aware per ADR-006.  
- [ ] Tests written and passing.  
- [ ] Odoo boots without errors (MANDATORY).  
- [ ] Proof of execution logs captured.  
- [ ] Code committed with descriptive message.

## 6. Required Context Documents

- `@aos-architecture/specs/evv/PT-001.yaml`
- `@aos-architecture/specs/evv/CM-001.yaml`
- `@aos-architecture/specs/core/CORE-001.yaml`
- `@aos-architecture/standards/01-odoo-coding-standards.md`
- `@aos-architecture/standards/08-testing-requirements.md`

## 7. MANDATORY: Proof of Execution Commands

```bash
cd /home/james/development/aos-development
docker compose exec evv odoo-bin \
  -c /etc/odoo/odoo.conf \
  -d evv \
  --test-enable \
  --stop-after-init \
  -i evv_patients \
  --log-level=test:INFO

docker compose up -d --force-recreate evv
sleep 30
docker compose logs --tail="100" evv

docker compose exec evv odoo-bin \
  -c /etc/odoo/odoo.conf \
  -d evv \
  -u evv_patients \
  --stop-after-init
```

- Provide test output, boot logs, upgrade confirmation. Escalate if Docker unavailable.


